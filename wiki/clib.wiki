#summary The C Standard Library for AS3.

== Introduction ==

From the beginning, redtamarin added a bit of support for C-like functions and packages.

We were calling that "a more or less standard C library" ;).

Now, as we want to do the right thing, we want to provide as much support as possible, put things at the right place and avoid shortcuts if possible.

The main principle still is the same

if you have this in *C*
{{{
//C
#include <stdlib.h>

//char *getenv( const char *name );
char *test = getenv("HOME");
}}}

then you can have this in *AS3*
{{{
//AS3
import C.stdlib.*;

//public function getenv( name:String ):String;
var test:String = getenv( "HOME" );
}}}

<br/>
<br/>
these are the main reasons to do that

  # in general, C give you a low-level universal access to things<br/>wether you know `chmod` on the command line or you used `mkdir()` in PHP, Python, etc.<br/>you already used a bit of *C* somewhere.
  # building uppon this kind of low-level you can build bigger things<br/>in our case we will reuse `mkdir()` to define `FileSystem.makeDirectory()`<br/>maybe you want to build your own API or do things a bit differently<br/>if only you had access to `mkdir()`...well you have access!!
  # A C library help to port to AS3 other kind of libraries,<br/>either duplicate something you have seen done in Python or Ruby, etc<br/>or easily port a C code example to AS3.
  # Those C libraries are mainly functions and are easily portable and sharable<br/>(we know from our experience with maashaack *core* package)
  # it helps at the same time C developers coming to AS3<br/>and AS3 developers learning/reusing C.

<br/>
But let's be clear, we are not saying we giving you a way to compile C to AS3 (if you need that use ANE or CrossBridge).

No, what we are saying is that we give you a way to integrates "C style programming and functionalities" into your AS3 program.

It is not perfect and have limitations, but when you want to build things for the command line and the server side it can come very handy.

<br/>

== What do we support exactly ? ==

We plan to support

The *C standard library*
  * *ANSI C* (C89)
  * *ISO C* (C90)

with those headers:
  * `<assert.h>`
  * `<ctype.h>`
  * `<errno.h>`
  * `<float.h>`
  * `<limits.h>`
  * `<locale.h>`
  * `<math.h>`
  * `<setjmp.h>`
  * `<signal.h>`
  * `<stdarg.h>`
  * `<stddef.h>`
  * `<stdio.h>`
  * `<stdlib.h>`
  * `<string.h>`
  * `<time.h>`

and

The *C POSIX Library*
  * *POSIX*.1

with those headers
  * `<cpio.h>`
  * `<dirent.h>`
  * `<fcntl.h>`
  * `<grp.h>`
  * `<netdb.h>`
  * `<pthread.h>`
  * `<pwd.h>`
  * `<spawn.h>`
  * `<sys/ipc.h>`
  * `<sys/mman.h>`
  * `<sys/msg.h>`
  * `<sys/sem.h>`
  * `<sys/stat.h>`
  * `<sys/time.h>`
  * `<sys/types.h>`
  * `<sys/utsname.h>`
  * `<sys/wait.h>`
  * `<tar.h>`
  * `<termios.h>`
  * `<unistd.h>`
  * `<utime.h>`

and some non-standard things

All that represent the *clib* or *The C Standard Library for AS3*.

<br/>

We will unlikely support 100% of C, simply because things work differently in AS3, but in general we will make our best effort to have a library that make sens to use.

<br/>

== Level of support ==

First, let's explain the basic.

This library is contained in the *C* package<br/>
and is in favour of an AS3 syntax.

in *C*
{{{
#include <stdlib.h>
#include <sys/stat.h>
}}}

in  *AS3*
{{{
import C.stdlib.*;
import C.sys.stat.*;
}}}

<br/>

Those C packages will mainly define
<br/>

*constants* and/or *macros*

{{{
package C.errno
{
    /**
     * Argument list too long.
     *
     * @langversion 3.0
     * @playerversion AVM 0.4
     */
    public const E2BIG:int = 7;
}
}}}

in some cases hardcoded for a common behaviour


{{{
package C.limits
{
    /**
     * Maximum number of bytes the implementation will store as a pathname.
     *
     * @langversion 3.0
     * @playerversion AVM 0.4
     */
    [native("::avmshell::CLimitsClass::get_PATH_MAX")]
    public native function get PATH_MAX():int;
}
}}}

sometimes dynamically fetched from the current system

<br/>

*functions*

{{{
package C.stdio
{
    /**
     * Rename a file.
     *
     * @langversion 3.0
     * @playerversion AVM 0.4
     */
    [native("::avmshell::CStdioClass::rename")]
    public native function rename( oldname:String, newname:String ):int;
}
}}}

that may or may not change the original C function signature

<br/>

*classes*

{{{
package C.stdio
{
    /**
     * A structure containing information about a file.
     *
     * <p>
     * <b>FILE</b> is a type suitable for storing information for a file stream.
     * </p>
     *
     * @langversion 3.0
     * @playerversion AVM 0.4
     */
    [native(cls="::avmshell::CFILEClass", instance="::avmshell::CFILEObject", methods="auto")]
    public class FILE
    {
        //...
    }
}
}}}

used to replace *typedef* and/or *struct* so the C context can exchange *types* with the AS3 context

<br/>

Here a usage example

if you have this in C
{{{
typedef FILE

typedef fpos_t

FILE *fopen(const char *filename, const char *mode);

int fgetpos(FILE *stream, fpos_t *pos);
}}}

you will use it like that in AS3
{{{
import C.errno.*;
import C.stdio.*;

var file:FILE = fopen( "foobar.txt", "w" );

var pos:fpos_t = new fpos_t();
var result:int = fgetpos( file, pos );

if( result != 0 )
{
    throw new CError( errno );
}
}}}

yep, it feels like C but it is still AS3.

<br/>

The following will details which level of support we provide per header or package.


<font color="orange">*ANSI C (C89) / ISO C (C90)*</font>

=== `<assert.h>` ===
<font color="red">not implemented</font>

Ideally we would like to support it but we are not sure yet how.

This header only define one function `assert()`<br/>
when used and called in C, it allows to assert than expression is valid<br/>
and if not, will return the expression used and the line number where it happen and then call `abort()`.

We can not use the native `assert()` call "as is", but we could try to replicate its functionalities<br/>
eg. returning the AS3 line where the assert was not valid and the expression string<br/>
and instead of calling `abort()` maybe interrupt the code like a `throw error` ?


=== `<ctype.h>` ===
<font color="green">fully supported</font>

although we do not support the extensions `isalnum_l()`, `isalpha_l()`, `isascii_l()`, etc.

=== `<errno.h>` ===
<font color="green">fully supported</font>
<font color="blue">some non standard</font>

*errno* being a very special macro in C, we used some tricks of our own in AS3.

In the AS3 side, *errno* is a constant of the type `ErrorNumber`.

This class `ErrorNumber` reuse 2 function calls `GetErrno()` and `SetErrno`
as getter / setter to read and write to *errno* on the C context.

The `valueOf()` return the integer value of *errno*, but the `toString()` return the string from `strerror()`.

It is usable and works well but the usage is a slightly bit different than in C.

Another bit of headache were the error constants that can be quite different between Windows and OS X / Linux,
and extremely different when it comes to sockets.

So far we opted to hardcode the constant with the Linux values and later will provide "conversion functions": from WIN32 to Linux and vise versa.


=== `<float.h>` ===
<font color="red">not supported</font>

The float header defines the minimum and maximum limits of floating-point number values.

It would be probably difficult to port its usage to an AS3 context, especially when the AVM2 redefine some types,
in particular of the context of *VMCFG_FLOAT* which can gives access to the *float* and *float4* types on the AS3 side.


=== `<limits.h>` ===
<font color="orange">partially supported</font>

We support things like *NAME_MAX* (Maximum number of bytes in a filename) because it can influence how you work with the file system etc.

But we will not support things like *CHARCLASS_NAME_MAX* (Maximum number of bytes in a character class name) as in AVM2/AS3 we roll with different rules.

=== `<locale.h>` ===
<font color="red">not implemented</font>

=== `<math.h>` ===
<font color="red">not implemented</font>

=== `<setjmp.h>` ===
<font color="red">not supported</font>

The setjmp header is used for controlling low-level calls and returns to and from functions.

Which would be difficult (if not impossible) to adapt to AS3.

=== `<signal.h>` ===
<font color="red">not implemented</font>

=== `<stdarg.h>` ===
<font color="red">not supported</font>

The stdarg header defines several macros used to get the arguments in a function when the number of arguments is not known.

In an AS3 context we roll with different rules.

=== `<stddef.h>` ===
<font color="red">not supported</font>

The stddef header defines several standard definitions. Many of these definitions also appear in other headers.

We don't plan to support "pointers" in an AS3 context.

We don't plan to adapt the use of `sizeof()` into the AS3 context.

We plan to support wide char trough the `String` type.

=== `<stdio.h>` ===
<font color="green">fully supported</font>

=== `<stdlib.h>` ===
<font color="green">fully supported</font>

=== `<string.h>` ===
<font color="green">fully supported</font>

=== `<time.h>` ===
<font color="red">not implemented</font>


<br/>
<br/>
<font color="orange">*POSIX.1*</font>
=== `<cpio.h>` ===
<font color="red">not implemented</font>

=== `<dirent.h>` ===
<font color="red">not implemented</font>

=== `<fcntl.h>` ===
<font color="red">not implemented</font>

=== `<grp.h>` ===
<font color="red">not implemented</font>

=== `<netdb.h>` ===
<font color="red">not implemented</font>

=== `<pthread.h>` ===
<font color="red">not implemented</font>

=== `<pwd.h>` ===
<font color="red">not implemented</font>

=== `<spawn.h>` ===
<font color="red">not implemented</font>

=== `<sys/ipc.h>` ===
<font color="red">not implemented</font>

=== `<sys/mman.h>` ===
<font color="red">not implemented</font>

=== `<sys/msg.h>` ===
<font color="red">not implemented</font>

=== `<sys/sem.h>` ===
<font color="red">not implemented</font>

=== `<sys/stat.h>` ===
<font color="red">not implemented</font>

=== `<sys/time.h>` ===
<font color="red">not implemented</font>

=== `<sys/types.h>` ===
<font color="red">not implemented</font>

=== `<sys/utsname.h>` ===
<font color="red">not implemented</font>

=== `<sys/wait.h>` ===
<font color="red">not implemented</font>

=== `<tar.h>` ===
<font color="red">not implemented</font>

=== `<termios.h>` ===
<font color="red">not implemented</font>

=== `<unistd.h>` ===
<font color="orange">partially supported</font>

=== `<utime.h>` ===
<font color="red">not implemented</font>